{
    "data": {
        "attributes": {
            "deffile": "BootStrap: docker\nFrom: centos:centos7\n\n%post\n    # ====================\n    #   Install basics\n    # ====================\n    yum -y update\n    yum install -y make wget vim git m4 bzip2 bc numpy-f2py centos-release-scl\n    yum install -y devtoolset-7-gcc-gfortran devtoolset-7-gcc-c++\n    yum clean all # clean-up cache\n\n    # ====================\n    #   Install NetCDF\n    # ====================\n\n    export installDir=/usr\n    export ZDIR=$installDir\n    export H5DIR=$installDir\n    export NCDIR=$installDir\n    export NFDIR=$installDir\n\n    export DIR=/opt/rh/devtoolset-7/root/usr/bin\n    export CC=$DIR/gcc\n    export CXX=$DIR/g++\n    export F77=$DIR/gfortran\n    export FC=$DIR/gfortran\n\n    cd /tmp\n\n    # == zlib ==\n    wget https://zlib.net/zlib-1.2.11.tar.gz\n    tar -xzf zlib-1.2.11.tar.gz\n    cd zlib-1.2.11\n    ./configure --prefix=${ZDIR}\n    make -j4\n    make install\n\n    cd /tmp\n\n    # == HDF5 ==\n    wget https://support.hdfgroup.org/ftp/HDF5/releases/hdf5-1.10/hdf5-1.10.2/src/hdf5-1.10.2.tar.gz\n    tar -xzf hdf5-1.10.2.tar.gz\n    cd hdf5-1.10.2\n    ./configure --with-zlib=${ZDIR} --prefix=${H5DIR}\n    make -j4\n    make install\n\n    cd /tmp\n\n    # == NetCDF-C ==\n    wget https://github.com/Unidata/netcdf-c/archive/v4.6.1.tar.gz\n    tar -xzf v4.6.1.tar.gz\n    cd netcdf-c-4.6.1\n    # don't need remote access\n    CPPFLAGS=-I${H5DIR}/include LDFLAGS=-L${H5DIR}/lib ./configure --prefix=${NCDIR} --disable-dap\n    make -j4\n    make install\n\n    cd /tmp\n\n    # == NetCDF-Fortran ==\n    export LD_LIBRARY_PATH=${NCDIR}/lib:${LD_LIBRARY_PATH}\n    wget https://github.com/Unidata/netcdf-fortran/archive/v4.4.4.tar.gz\n    tar -xzf v4.4.4.tar.gz\n    cd netcdf-fortran-4.4.4\n    CPPFLAGS=-I${NCDIR}/include LDFLAGS=-L${NCDIR}/lib ./configure --prefix=${NFDIR}\n    make -j4\n    make install\n\n    cd /tmp\n\n    # ====================\n    #   Install MPI\n    # ====================\n\n    # == MPICH ==\n    # https://www.mpich.org/downloads/\n    wget http://www.mpich.org/static/downloads/3.2.1/mpich-3.2.1.tar.gz\n    tar zxf mpich-3.2.1.tar.gz\n    cd mpich-3.2.1\n    ./configure prefix=/usr/local/mpich\n    make -j4\n    make install\n\n    cd /tmp\n\n    # ====================\n    #   Clean up\n    # ====================\n\n    rm -rf /tmp/*\n\n%environment\n    # fix Singularity + Perl error\n    # https://groups.google.com/a/lbl.gov/forum/#!msg/singularity/58Xr72oDfBg/m3Y7Nr_PBAAJ\n    export LANG=C\n\n    # gfortran7\n    export PATH=/opt/rh/devtoolset-7/root/usr/bin:$PATH\n\n    # ====================================\n    # --- Same as GEOS-Chem classic  ---\n    # ====================================\n\n    export NETCDF_HOME=/usr\n    export NETCDF_FORTRAN_HOME=/usr\n    export LD_LIBRARY_PATH=/usr/lib:$LD_LIBRARY_PATH # for libnetcdff.so\n\n    export FC=gfortran\n    export CC=gcc\n    export CXX=g++\n\n    export GC_BIN=$NETCDF_HOME/bin\n    export GC_INCLUDE=$NETCDF_HOME/include\n    export GC_LIB=$NETCDF_HOME/lib\n\n    export GC_F_BIN=$NETCDF_FORTRAN_HOME/bin\n    export GC_F_INCLUDE=$NETCDF_FORTRAN_HOME/include\n    export GC_F_LIB=$NETCDF_FORTRAN_HOME/lib\n\n    # ====================================\n    # --- GCHP-specific settings  ---\n    # ====================================\n\n    export OMPI_CC=$CC\n    export OMPI_CXX=$CXX\n    export OMPI_FC=$FC\n    export F77=$FC\n    export F90=$FC\n    export COMPILER=$FC # needed for gfortran?\n\n    export MPI_ROOT=/usr/local/mpich\n    export PATH=$MPI_ROOT/bin:$PATH\n    export ESMF_COMM=mpich2\n\n    # ====================================\n    # --- Dirty fixes for MAPL  ---\n    # ====================================\n\n    # --- Fixes for header files (\"#include <xxx.h>\" statement) ---\n    # mpi.h locates at /usr/include so MAPL can find it\n    export CPATH=$GC_CODE_DIR/GCHP/Shared/MAPL_Base:$CPATH # MAPL_Generic.h\n    export CPATH=$GC_CODE_DIR/GCHP/Shared/GFDL_fms/shared/include:$CPATH # fms_platform.h\n    export CPATH=$GC_CODE_DIR/GCHP/gchp_standard/CodeDir/GCHP/ESMF/Linux/include:$CPATH # ESMF_ErrReturnCodes.inc\n\n%runscript\n    echo \"Container for GCHP environment\"\n    echo \"Please use run it interactively by, for example:\"\n    echo \"SINGULARITYENV_GC_CODE_DIR=~/GCHP/Code.v11-02_gchp singularity shell GCHP.simg\"\n    echo \"To enable coloring inside container, run:\"\n    echo 'alias ls=\"ls --color=auto\"'",
            "help": null,
            "labels": {
                "org.label-schema.usage.singularity.deffile.bootstrap": "docker",
                "org.label-schema.usage.singularity.deffile": "Singularity",
                "org.label-schema.schema-version": "1.0",
                "org.label-schema.usage.singularity.deffile.from": "centos:centos7",
                "org.label-schema.build-date": "Sun,_22_Apr_2018_01:46:18_+0000",
                "org.label-schema.usage.singularity.version": "2.4.1-feature-squashbuild-secbuild-2.4.1.g220f8e0",
                "org.label-schema.build-size": "556MB"
            },
            "environment": "# Custom environment shell code should follow\n\n    # fix Singularity + Perl error\n    # https://groups.google.com/a/lbl.gov/forum/#!msg/singularity/58Xr72oDfBg/m3Y7Nr_PBAAJ\n    export LANG=C\n\n    # gfortran7\n    export PATH=/opt/rh/devtoolset-7/root/usr/bin:$PATH\n\n    # ====================================\n    # --- Same as GEOS-Chem classic  ---\n    # ====================================\n\n    export NETCDF_HOME=/usr\n    export NETCDF_FORTRAN_HOME=/usr\n    export LD_LIBRARY_PATH=/usr/lib:$LD_LIBRARY_PATH # for libnetcdff.so\n\n    export FC=gfortran\n    export CC=gcc\n    export CXX=g++\n\n    export GC_BIN=$NETCDF_HOME/bin\n    export GC_INCLUDE=$NETCDF_HOME/include\n    export GC_LIB=$NETCDF_HOME/lib\n\n    export GC_F_BIN=$NETCDF_FORTRAN_HOME/bin\n    export GC_F_INCLUDE=$NETCDF_FORTRAN_HOME/include\n    export GC_F_LIB=$NETCDF_FORTRAN_HOME/lib\n\n    # ====================================\n    # --- GCHP-specific settings  ---\n    # ====================================\n\n    export OMPI_CC=$CC\n    export OMPI_CXX=$CXX\n    export OMPI_FC=$FC\n    export F77=$FC\n    export F90=$FC\n    export COMPILER=$FC # needed for gfortran?\n\n    export MPI_ROOT=/usr/local/mpich\n    export PATH=$MPI_ROOT/bin:$PATH\n    export ESMF_COMM=mpich2\n\n    # ====================================\n    # --- Dirty fixes for MAPL  ---\n    # ====================================\n\n    # --- Fixes for header files (\"#include <xxx.h>\" statement) ---\n    # mpi.h locates at /usr/include so MAPL can find it\n    export CPATH=$GC_CODE_DIR/GCHP/Shared/MAPL_Base:$CPATH # MAPL_Generic.h\n    export CPATH=$GC_CODE_DIR/GCHP/Shared/GFDL_fms/shared/include:$CPATH # fms_platform.h\n    export CPATH=$GC_CODE_DIR/GCHP/gchp_standard/CodeDir/GCHP/ESMF/Linux/include:$CPATH # ESMF_ErrReturnCodes.inc\n\n",
            "runscript": "#!/bin/sh \n\n    echo \"Container for GCHP environment\"\n    echo \"Please use run it interactively by, for example:\"\n    echo \"SINGULARITYENV_GC_CODE_DIR=~/GCHP/Code.v11-02_gchp singularity shell GCHP.simg\"\n    echo \"To enable coloring inside container, run:\"\n    echo 'alias ls=\"ls --color=auto\"'",
            "test": null
        },
        "type": "container"
    }
}
